var XJX=function(e){"use strict";class t extends Error{constructor(e){super(e),this.name="XMLToJSONError"}}const r=(()=>{let e,r,n,o,s=null;try{if("undefined"==typeof window)try{const{JSDOM:t}=require("jsdom");s=new t("<!DOCTYPE html><html><body></body></html>",{contentType:"text/xml"}),e=s.window.DOMParser,r=s.window.XMLSerializer,n={ELEMENT_NODE:s.window.Node.ELEMENT_NODE,TEXT_NODE:s.window.Node.TEXT_NODE,CDATA_SECTION_NODE:s.window.Node.CDATA_SECTION_NODE,COMMENT_NODE:s.window.Node.COMMENT_NODE,PROCESSING_INSTRUCTION_NODE:s.window.Node.PROCESSING_INSTRUCTION_NODE,DOCUMENT_NODE:s.window.Node.DOCUMENT_NODE},o=s.window.document.implementation}catch(s){try{const{DOMParser:t,XMLSerializer:s,DOMImplementation:i}=require("@xmldom/xmldom");e=t,r=s,n={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,PROCESSING_INSTRUCTION_NODE:7,DOCUMENT_NODE:9};const a=new i;o=a}catch(e){throw new t("Node.js environment detected but neither 'jsdom' nor '@xmldom/xmldom' are available.")}}else{if(!window.DOMParser)throw new t("DOMParser is not available in this environment");if(!window.XMLSerializer)throw new t("XMLSerializer is not available in this environment");e=window.DOMParser,r=window.XMLSerializer,n={ELEMENT_NODE:Node.ELEMENT_NODE,TEXT_NODE:Node.TEXT_NODE,CDATA_SECTION_NODE:Node.CDATA_SECTION_NODE,COMMENT_NODE:Node.COMMENT_NODE,PROCESSING_INSTRUCTION_NODE:Node.PROCESSING_INSTRUCTION_NODE,DOCUMENT_NODE:Node.DOCUMENT_NODE},o=document.implementation}}catch(e){throw new t(`DOM environment initialization failed: ${e instanceof Error?e.message:String(e)}`)}return{createParser:()=>{try{return new e}catch(e){throw new t(`Failed to create DOM parser: ${e instanceof Error?e.message:String(e)}`)}},createSerializer:()=>{try{return new r}catch(e){throw new t(`Failed to create XML serializer: ${e instanceof Error?e.message:String(e)}`)}},nodeTypes:n,parseFromString:(r,n="text/xml")=>{try{return(new e).parseFromString(r,n)}catch(e){throw new t(`Failed to parse XML: ${e instanceof Error?e.message:String(e)}`)}},serializeToString:e=>{try{return(new r).serializeToString(e)}catch(e){throw new t(`Failed to serialize XML: ${e instanceof Error?e.message:String(e)}`)}},createDocument:()=>{try{if("undefined"!=typeof window){return(new e).parseFromString("<temp></temp>","text/xml")}return o.createDocument(null,null,null)}catch(e){throw new t(`Failed to create document: ${e instanceof Error?e.message:String(e)}`)}},createElement:e=>{try{if("undefined"!=typeof window)return document.createElement(e);return o.createDocument(null,null,null).createElement(e)}catch(e){throw new t(`Failed to create element: ${e instanceof Error?e.message:String(e)}`)}},createElementNS:(e,r)=>{try{if("undefined"!=typeof window)return document.createElementNS(e,r);return o.createDocument(null,null,null).createElementNS(e,r)}catch(e){throw new t(`Failed to create element with namespace: ${e instanceof Error?e.message:String(e)}`)}},createTextNode:e=>{try{if("undefined"!=typeof window)return document.createTextNode(e);return o.createDocument(null,null,null).createTextNode(e)}catch(e){throw new t(`Failed to create text node: ${e instanceof Error?e.message:String(e)}`)}},createCDATASection:e=>{try{if("undefined"!=typeof window){return document.implementation.createDocument(null,null,null).createCDATASection(e)}return o.createDocument(null,null,null).createCDATASection(e)}catch(e){throw new t(`Failed to create CDATA section: ${e instanceof Error?e.message:String(e)}`)}},createComment:e=>{try{if("undefined"!=typeof window)return document.createComment(e);return o.createDocument(null,null,null).createComment(e)}catch(e){throw new t(`Failed to create comment: ${e instanceof Error?e.message:String(e)}`)}},createProcessingInstruction:(e,r)=>{try{if("undefined"!=typeof window){return document.implementation.createDocument(null,null,null).createProcessingInstruction(e,r)}return o.createDocument(null,null,null).createProcessingInstruction(e,r)}catch(e){throw new t(`Failed to create processing instruction: ${e instanceof Error?e.message:String(e)}`)}},setNamespacedAttribute:(e,r,n,o)=>{try{r?e.setAttributeNS(r,n,o):e.setAttribute(n,o)}catch(e){throw new t(`Failed to set attribute: ${e instanceof Error?e.message:String(e)}`)}},isNode:e=>{try{return e&&"object"==typeof e&&"number"==typeof e.nodeType}catch(e){return!1}},getNodeTypeName:e=>{switch(e){case n.ELEMENT_NODE:return"ELEMENT_NODE";case n.TEXT_NODE:return"TEXT_NODE";case n.CDATA_SECTION_NODE:return"CDATA_SECTION_NODE";case n.COMMENT_NODE:return"COMMENT_NODE";case n.PROCESSING_INSTRUCTION_NODE:return"PROCESSING_INSTRUCTION_NODE";default:return`UNKNOWN_NODE_TYPE(${e})`}},getNodeAttributes:e=>{const t={};for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];t[n.name]=n.value}return t},cleanup:()=>{s&&"function"==typeof s.window.close&&s.window.close()}}})();class n{constructor(e){this.config=e}getPath(e,t,r=void 0){const n=t.split(".");let o=e;for(const e of n){if(Array.isArray(o)){const t=o.map((t=>this.resolveSegment(t,e))).flat().filter((e=>void 0!==e));o=t.length>0?t:void 0}else o=this.resolveSegment(o,e);if(void 0===o)return r}return Array.isArray(o)&&1===o.length?o[0]:void 0!==o?o:r}resolveSegment(e,t){if(null==e||"object"!=typeof e)return;if(t in e)return e[t];if(t===this.config.propNames.value||t===this.config.propNames.children||t===this.config.propNames.attributes||t===this.config.propNames.namespace||t===this.config.propNames.prefix||t===this.config.propNames.cdata||t===this.config.propNames.comments||t===this.config.propNames.instruction||t===this.config.propNames.target){const r=Object.entries(this.config.propNames).find((([e,r])=>r===t))?.[0];if(r&&void 0!==e[t])return e[t]}const r=e[this.config.propNames.children];if(Array.isArray(r)){const e=r.map((e=>t in e?e[t]:void 0)).filter((e=>void 0!==e));return e.length>0?e:void 0}}fromJSONObject(e,t){const r=this.wrapObject(e);if("string"==typeof t)return{[t]:r};if(t&&"object"==typeof t){const e=t.name||"root",n=t[this.config.propNames.prefix]||"",o=n?`${n}:${e}`:e,s={[o]:{}},i=this.config.propNames.attributes;t[i]&&Array.isArray(t[i])&&(s[o][i]=t[i]);const a=this.config.propNames.children,c=t[a]?t[a]:[];s[o][a]=[...c,{[e]:r}];const l=this.config.propNames.namespace;return t[l]&&(s[o][l]=t[l]),n&&t[l]&&(s[o][`xmlns:${n}`]=t[l]),s}return r}wrapObject(e){const t=this.config.propNames.value,r=this.config.propNames.children;if(null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return{[t]:e};if(Array.isArray(e))return{[r]:e.map((e=>this.wrapObject(e)))};if("object"==typeof e){const t=Object.entries(e).map((([e,t])=>({[e]:this.wrapObject(t)})));return{[r]:t}}}isEmpty(e){return null==e||(Array.isArray(e)?0===e.length:"object"==typeof e&&0===Object.keys(e).length)}safeStringify(e,t=2){try{return JSON.stringify(e,null,t)}catch(e){return"[Cannot stringify object]"}}deepClone(e){try{return JSON.parse(JSON.stringify(e))}catch(e){throw new Error(`Failed to deep clone object: ${e instanceof Error?e.message:String(e)}`)}}deepMerge(e,t){return t&&"object"==typeof t&&null!==t?e&&"object"==typeof e&&null!==e?(Object.keys(t).forEach((r=>{const n=t[r],o=e[r];null===n||null===o||"object"!=typeof n||"object"!=typeof o||Array.isArray(n)||Array.isArray(o)?e[r]=n:e[r]=this.deepMerge(o,n)})),e):t:e}}class o{constructor(e){this.config=e}applyTransforms(e,t){if(!this.config.valueTransforms||0===this.config.valueTransforms.length)return e;let r=e;for(const e of this.config.valueTransforms)r=e.process(r,t);return r}createContext(e,t,r,n={}){return{direction:e,nodeName:t,nodeType:r,path:n.path||t,namespace:n.namespace,prefix:n.prefix,isAttribute:n.isAttribute||!1,attributeName:n.attributeName,parent:n.parent,config:this.config}}getNodeTypeName(e){return r.getNodeTypeName(e)}}class s{constructor(e){this.config=e,this.jsonUtil=new n(this.config),this.transformUtil=new o(this.config)}parse(e){try{const n=r.parseFromString(e,"text/xml"),o=n.getElementsByTagName("parsererror");if(o.length>0)throw new t(`XML parsing error: ${o[0].textContent}`);return this.nodeToJson(n.documentElement)}catch(e){throw new t(`Failed to convert XML to JSON: ${e instanceof Error?e.message:String(e)}`)}}nodeToJson(e,t,n=""){const o={};if(e.nodeType===r.nodeTypes.ELEMENT_NODE){const s=e,i=s.localName||s.nodeName.split(":").pop()||s.nodeName,a=n?`${n}.${i}`:i,c={},l=this.transformUtil.createContext("xml-to-json",i,e.nodeType,{path:a,namespace:s.namespaceURI||void 0,prefix:s.prefix||void 0,parent:t});if(this.config.preserveNamespaces){const e=s.namespaceURI;e&&(c[this.config.propNames.namespace]=e);const t=s.prefix;t&&(c[this.config.propNames.prefix]=t)}if(this.config.preserveAttributes&&s.attributes.length>0){const t=[];for(let r=0;r<s.attributes.length;r++){const n=s.attributes[r],o=n.localName||n.name.split(":").pop()||n.name,c=this.transformUtil.createContext("xml-to-json",i,e.nodeType,{path:`${a}.${o}`,namespace:n.namespaceURI||void 0,prefix:n.prefix||void 0,isAttribute:!0,attributeName:o,parent:l}),p=this.transformUtil.applyTransforms(n.value,c),m={[o]:{[this.config.propNames.value]:p}};this.config.preserveNamespaces&&(n.namespaceURI&&(m[o][this.config.propNames.namespace]=n.namespaceURI),n.prefix&&(m[o][this.config.propNames.prefix]=n.prefix)),t.push(m)}t.length>0&&(c[this.config.propNames.attributes]=t)}if(s.childNodes.length>0){const e=[],t=this.config.propNames.children,n=this.config.propNames.value,o=this.config.propNames.cdata,i=this.config.propNames.comments,p=this.config.propNames.instruction,m=this.config.propNames.target;for(let t=0;t<s.childNodes.length;t++){const c=s.childNodes[t];if(c.nodeType===r.nodeTypes.TEXT_NODE){if(this.config.preserveTextNodes){let t=c.nodeValue||"";if(!this.config.preserveWhitespace){if(""===t.trim())continue;t=t.trim()}const r=this.transformUtil.createContext("xml-to-json","#text",c.nodeType,{path:`${a}.#text`,parent:l}),o=this.transformUtil.applyTransforms(t,r);e.push({[n]:o})}}else if(c.nodeType===r.nodeTypes.CDATA_SECTION_NODE&&this.config.preserveCDATA){const t=this.transformUtil.createContext("xml-to-json","#cdata",c.nodeType,{path:`${a}.#cdata`,parent:l}),r=this.transformUtil.applyTransforms(c.nodeValue||"",t);e.push({[o]:r})}else c.nodeType===r.nodeTypes.COMMENT_NODE&&this.config.preserveComments?e.push({[i]:c.nodeValue||""}):c.nodeType===r.nodeTypes.PROCESSING_INSTRUCTION_NODE&&this.config.preserveProcessingInstr?e.push({[p]:{[m]:c.nodeName,[n]:c.nodeValue||""}}):c.nodeType===r.nodeTypes.ELEMENT_NODE&&e.push(this.nodeToJson(c,l,a))}e.length>0&&(c[t]=e)}this.config.outputOptions.compact&&Object.keys(c).forEach((e=>{const t=this.cleanNode(c[e]);void 0===t?delete c[e]:c[e]=t})),o[i]=c}return o}cleanNode(e){if(Array.isArray(e)){const t=e.map((e=>this.cleanNode(e))).filter((e=>!(null==e||"object"==typeof e&&0===Object.keys(e).length)));return t.length>0?t:void 0}if("object"==typeof e&&null!==e){Object.keys(e).forEach((t=>{const r=this.cleanNode(e[t]);null==r||Array.isArray(r)&&0===r.length||"object"==typeof r&&0===Object.keys(r).length?delete e[t]:e[t]=r}));const t=this.config.propNames.children,r=this.config.propNames.attributes;if(Object.keys(e).every((e=>e===t||e===r))&&(void 0===e[t]||this.jsonUtil.isEmpty(e[t]))&&(void 0===e[r]||this.jsonUtil.isEmpty(e[r])))return;return Object.keys(e).length>0?e:void 0}return e}}class i{constructor(e){this.config=e}prettyPrintXml(e){const n=this.config.outputOptions.indent,o=" ".repeat(n);try{const t=r.parseFromString(e,"text/xml"),n=(e,t=0)=>{const s=o.repeat(t);switch(e.nodeType){case r.nodeTypes.ELEMENT_NODE:{const o=e,i=o.tagName,a=Array.from(o.attributes).map((e=>`${e.name}="${e.value}"`)).join(" "),c=a?`<${i} ${a}>`:`<${i}>`,l=Array.from(o.childNodes);if(0===l.length)return`${s}${c.replace(/>$/," />")}\n`;if(0===l.length||1===l.length&&l[0].nodeType===r.nodeTypes.TEXT_NODE&&""===l[0].textContent?.trim())return`${s}<${i}${a?" "+a:""}></${i}>\n`;return`${s}${c}\n${l.map((e=>n(e,t+1))).join("")}${s}</${i}>\n`}case r.nodeTypes.TEXT_NODE:{const t=e.textContent?.trim();return t?`${s}${t}\n`:""}case r.nodeTypes.CDATA_SECTION_NODE:return`${s}<![CDATA[${e.nodeValue}]]>\n`;case r.nodeTypes.COMMENT_NODE:return`${s}\x3c!--${e.nodeValue}--\x3e\n`;case r.nodeTypes.PROCESSING_INSTRUCTION_NODE:const o=e;return`${s}<?${o.target} ${o.data}?>\n`;case r.nodeTypes.DOCUMENT_NODE:return Array.from(e.childNodes).map((e=>n(e,t))).join("");default:return""}};return n(t).trim()}catch(e){throw new t(`Failed to pretty print XML: ${e instanceof Error?e.message:String(e)}`)}}validateXML(e){try{const t=r.parseFromString(e,"text/xml").getElementsByTagName("parsererror");return t.length>0?{isValid:!1,message:t[0].textContent||"Unknown parsing error"}:{isValid:!0}}catch(e){return{isValid:!1,message:e instanceof Error?e.message:String(e)}}}ensureXMLDeclaration(e){return e.trim().startsWith("<?xml")?e:'<?xml version="1.0" encoding="UTF-8"?>\n'+e}escapeXML(e){return"string"!=typeof e||0===e.length?"":e.replace(/[&<>"']/g,(e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&apos;";default:return e}}))}unescapeXML(e){return"string"!=typeof e||0===e.length?"":e.replace(/&(amp|lt|gt|quot|apos);/g,((e,t)=>{switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';case"apos":return"'";default:return e}}))}extractPrefix(e){const t=e.indexOf(":");return t>0?e.substring(0,t):null}extractLocalName(e){const t=e.indexOf(":");return t>0?e.substring(t+1):e}createQualifiedName(e,t){return e?`${e}:${t}`:t}}class a{constructor(e){this.config=e,this.xmlUtil=new i(this.config),this.transformUtil=new o(this.config)}serialize(e){try{const t=r.createDocument(),n=this.jsonToNode(e,t);n&&(t.documentElement&&"temp"===t.documentElement.nodeName?t.replaceChild(n,t.documentElement):t.appendChild(n));let o=r.serializeToString(t);return o=o.replace(' xmlns="http://www.w3.org/1999/xhtml"',""),this.config.outputOptions.xml.declaration&&(o=this.xmlUtil.ensureXMLDeclaration(o)),this.config.outputOptions.prettyPrint&&(o=this.xmlUtil.prettyPrintXml(o)),o}catch(e){throw new t(`Failed to convert JSON to XML: ${e instanceof Error?e.message:String(e)}`)}}jsonToNode(e,t,n,o=""){if(!e||"object"!=typeof e)return null;const s=Object.keys(e)[0];if(!s)return null;const i=e[s],a=o?`${o}.${s}`:s;let c;const l=this.config.propNames.namespace,p=this.config.propNames.prefix,m=i[l],u=i[p],f=this.transformUtil.createContext("json-to-xml",s,r.nodeTypes.ELEMENT_NODE,{path:a,namespace:m,prefix:u,parent:n});c=m&&this.config.preserveNamespaces?u?r.createElementNS(m,`${u}:${s}`):r.createElementNS(m,s):r.createElement(s);const h=this.config.propNames.attributes,d=this.config.propNames.value;if(this.config.preserveAttributes&&i[h]&&Array.isArray(i[h])&&i[h].forEach((e=>{const t=Object.keys(e)[0];if(!t)return;const n=e[t],o=this.transformUtil.createContext("json-to-xml",s,r.nodeTypes.ELEMENT_NODE,{path:`${a}.${t}`,namespace:n[l],prefix:n[p],isAttribute:!0,attributeName:t,parent:f}),i=this.transformUtil.applyTransforms(n[d]||"",o),m=n[l],u=n[p];let h=t;u&&this.config.preserveNamespaces&&(h=`${u}:${t}`),r.setNamespacedAttribute(c,m&&this.config.preserveNamespaces?m:null,h,i)})),void 0!==i[d]){const e=this.transformUtil.createContext("json-to-xml",s,r.nodeTypes.TEXT_NODE,{path:`${a}.#text`,namespace:m,prefix:u,parent:f}),t=this.transformUtil.applyTransforms(i[d],e);c.textContent=t}const N=this.config.propNames.children,g=this.config.propNames.cdata,E=this.config.propNames.comments,T=this.config.propNames.instruction,y=this.config.propNames.target;return i[N]&&Array.isArray(i[N])&&i[N].forEach((e=>{if(void 0!==e[d]&&this.config.preserveTextNodes){const t=this.transformUtil.createContext("json-to-xml","#text",r.nodeTypes.TEXT_NODE,{path:`${a}.#text`,parent:f}),n=this.transformUtil.applyTransforms(e[d],t);c.appendChild(r.createTextNode(this.xmlUtil.escapeXML(n)))}else if(void 0!==e[g]&&this.config.preserveCDATA){const t=this.transformUtil.createContext("json-to-xml","#cdata",r.nodeTypes.CDATA_SECTION_NODE,{path:`${a}.#cdata`,parent:f}),n=this.transformUtil.applyTransforms(e[g],t);c.appendChild(r.createCDATASection(n))}else if(void 0!==e[E]&&this.config.preserveComments)c.appendChild(r.createComment(e[E]));else if(void 0!==e[T]&&this.config.preserveProcessingInstr){const t=e[T],n=t[y],o=t[d]||"";n&&c.appendChild(r.createProcessingInstruction(n,o))}else{const r=this.jsonToNode(e,t,f,a);r&&c.appendChild(r)}})),c}}const c={preserveNamespaces:!0,preserveComments:!0,preserveProcessingInstr:!0,preserveCDATA:!0,preserveTextNodes:!0,preserveWhitespace:!1,preserveAttributes:!0,outputOptions:{prettyPrint:!0,indent:2,compact:!0,json:{},xml:{declaration:!0}},propNames:{namespace:"$ns",prefix:"$pre",attributes:"$attr",value:"$val",cdata:"$cdata",comments:"$cmnt",instruction:"$pi",target:"$trgt",children:"$children"}};class l{constructor(e={}){this.jsonUtil=new n(c);const t=this.jsonUtil.deepClone(c);this.config=this.jsonUtil.deepMerge(t,e),this.jsonUtil=new n(this.config),this.xmlUtil=new i(this.config),this.xmltojson=new s(this.config),this.jsontoxml=new a(this.config)}xmlToJson(e){return this.xmltojson.parse(e)}jsonToXml(e){return this.jsontoxml.serialize(e)}prettyPrintXml(e){return this.xmlUtil.prettyPrintXml(e)}getPath(e,t,r=void 0){return this.jsonUtil.getPath(e,t,r)}validateXML(e){return this.xmlUtil.validateXML(e)}addTransformer(e){return this.config.valueTransforms||(this.config.valueTransforms=[]),this.config.valueTransforms.push(e),this}clearTransformers(){return this.config.valueTransforms=[],this}cleanup(){r.cleanup()}}return e.DEFAULT_CONFIG=c,e.ValueTransformer=class{process(e,t){return"xml-to-json"===t.direction?this.xmlToJson(e,t):this.jsonToXml(e,t)}xmlToJson(e,t){return e}jsonToXml(e,t){return e}},e.XJX=l,e.XJXError=t,e.default=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=xjx.min.js.map
