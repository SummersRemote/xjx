<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XJX Semantic Migration Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .test-section {
            margin: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
        }
        .test-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            color: #333;
        }
        .test-content {
            padding: 15px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .input-area, .output-area {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .area-header {
            background: #e9ecef;
            padding: 10px;
            font-weight: bold;
            color: #495057;
            font-size: 14px;
        }
        .area-content {
            padding: 15px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
        }
        textarea {
            width: 100%;
            height: 120px;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            outline: none;
        }
        pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .checkbox-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 XJX Semantic Migration Test Suite</h1>
            <p>Testing semantic XNode system with various conversion scenarios</p>
        </div>

        <!-- Test 1: Basic XML to JSON -->
        <div class="test-section">
            <div class="test-header">Test 1: Basic XML ↔ JSON Conversion</div>
            <div class="test-content">
                <div class="test-grid">
                    <div class="input-area">
                        <div class="area-header">Input XML</div>
                        <div class="area-content">
                            <textarea id="test1-xml">
<books xmlns:isbn="http://isbn.org">
    <book id="1" isbn:number="978-1234567890">
        <title>Semantic Programming</title>
        <author>Jane Doe</author>
        <price currency="USD">29.99</price>
        <tags>
            <tag>programming</tag>
            <tag>semantic</tag>
        </tags>
    </book>
    <book id="2">
        <title>Advanced XML</title>
        <author>John Smith</author>
        <price currency="EUR">24.50</price>
    </book>
</books>
                            </textarea>
                        </div>
                    </div>
                    <div class="output-area">
                        <div class="area-header">Output JSON</div>
                        <div class="area-content">
                            <pre id="test1-output"></pre>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="runTest1('standard')">Convert Standard</button>
                    <button onclick="runTest1('hifi')">Convert High-Fidelity</button>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="test1-preserveNS"> Preserve Namespaces</label>
                        <label><input type="checkbox" id="test1-pretty" checked> Pretty Print</label>
                    </div>
                </div>
                <div id="test1-status"></div>
            </div>
        </div>

        <!-- Test 2: Complex XML Features -->
        <div class="test-section">
            <div class="test-header">Test 2: Complex XML Features (CDATA, Comments, Processing Instructions)</div>
            <div class="test-content">
                <div class="test-grid">
                    <div class="input-area">
                        <div class="area-header">Input XML with Special Content</div>
                        <div class="area-content">
                            <textarea id="test2-xml">
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="transform.xsl"?>
<document xmlns="http://example.com/doc" xmlns:meta="http://example.com/meta">
    <!-- This is a test document with various XML features -->
    <header meta:version="2.0">
        <title><![CDATA[XML & JSON <Conversion> Test]]></title>
        <description>This document contains mixed content with <em>emphasis</em> and plain text.</description>
    </header>
    
    <data>
        <![CDATA[
        function example() {
            return "Hello World!";
        }
        ]]>
    </data>
    
    <items>
        <item type="text">Plain text item</item>
        <item type="html">Item with <strong>HTML</strong> content</item>
        <item type="code"><![CDATA[console.log("test");]]></item>
    </items>
    
    <!-- Processing complete -->
</document>
                            </textarea>
                        </div>
                    </div>
                    <div class="output-area">
                        <div class="area-header">Output JSON</div>
                        <div class="area-content">
                            <pre id="test2-output"></pre>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="runTest2('standard')">Convert Standard</button>
                    <button onclick="runTest2('hifi')">Convert High-Fidelity</button>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="test2-preserveComments" checked> Preserve Comments</label>
                        <label><input type="checkbox" id="test2-preserveCDATA" checked> Preserve CDATA</label>
                        <label><input type="checkbox" id="test2-preserveInstructions" checked> Preserve Processing Instructions</label>
                    </div>
                </div>
                <div id="test2-status"></div>
            </div>
        </div>

        <!-- Test 3: Transforms and Functional API -->
        <div class="test-section">
            <div class="test-header">Test 3: Transforms and Functional API</div>
            <div class="test-content">
                <div class="test-grid">
                    <div class="input-area">
                        <div class="area-header">Input XML with Numbers and Booleans</div>
                        <div class="area-content">
                            <textarea id="test3-xml">
<products>
    <product active="true" featured="yes">
        <name>Widget A</name>
        <price>$29.99</price>
        <stock>150</stock>
        <rating>4.5</rating>
        <available>1</available>
    </product>
    <product active="false" featured="no">
        <name>Widget B</name>
        <price>€24,50</price>
        <stock>75</stock>
        <rating>3.8</rating>
        <available>0</available>
    </product>
    <product active="true" featured="1">
        <name>Widget C</name>
        <price>£19.99</price>
        <stock>200</stock>
        <rating>4.9</rating>
        <available>true</available>
    </product>
</products>
                            </textarea>
                        </div>
                    </div>
                    <div class="output-area">
                        <div class="area-header">Transformed Output</div>
                        <div class="area-content">
                            <pre id="test3-output"></pre>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="runTest3()">Apply Transforms</button>
                    <button onclick="runTest3Filter()">Filter High-Rating Products</button>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="test3-transformNumbers" checked> Transform Numbers</label>
                        <label><input type="checkbox" id="test3-transformBooleans" checked> Transform Booleans</label>
                        <label><input type="checkbox" id="test3-transformAttributes" checked> Transform Attributes</label>
                    </div>
                </div>
                <div id="test3-status"></div>
            </div>
        </div>

        <!-- Test 4: JSON Array Handling -->
        <div class="test-section">
            <div class="test-header">Test 4: JSON Array Handling</div>
            <div class="test-content">
                <div class="test-grid">
                    <div class="input-area">
                        <div class="area-header">Input JSON with Arrays</div>
                        <div class="area-content">
                            <textarea id="test4-json">
{
    "company": "Tech Solutions Inc",
    "employees": [
        {
            "id": 1,
            "name": "Alice Johnson",
            "departments": ["Engineering", "R&D"],
            "skills": ["JavaScript", "Python", "React"],
            "active": true,
            "salary": 85000
        },
        {
            "id": 2,
            "name": "Bob Smith",
            "departments": ["Marketing"],
            "skills": ["SEO", "Content Writing"],
            "active": false,
            "salary": 55000
        }
    ],
    "offices": [
        {
            "location": "New York",
            "employees": 150,
            "established": 2010
        },
        {
            "location": "San Francisco", 
            "employees": 75,
            "established": 2015
        }
    ],
    "tags": ["technology", "innovation", "growth"]
}
                            </textarea>
                        </div>
                    </div>
                    <div class="output-area">
                        <div class="area-header">XML Output</div>
                        <div class="area-content">
                            <pre id="test4-output"></pre>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="runTest4()">JSON → XML</button>
                    <button onclick="runTest4RoundTrip()">Round Trip (JSON → XML → JSON)</button>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="test4-hifi" checked> High-Fidelity Mode</label>
                        <label><input type="checkbox" id="test4-prettyXml" checked> Pretty XML</label>
                    </div>
                </div>
                <div id="test4-status"></div>
            </div>
        </div>

        <!-- Test 5: Round-trip Conversion -->
        <div class="test-section">
            <div class="test-header">Test 5: Round-trip Integrity Test</div>
            <div class="test-content">
                <div class="test-grid">
                    <div class="input-area">
                        <div class="area-header">Original XML</div>
                        <div class="area-content">
                            <textarea id="test5-xml">
<library xmlns:dc="http://purl.org/dc/elements/1.1/">
    <book dc:identifier="isbn:978-0123456789">
        <dc:title>The Semantic Web</dc:title>
        <dc:creator>Tim Berners-Lee</dc:creator>
        <metadata>
            <created>2023-01-15</created>
            <modified>2023-06-20</modified>
            <tags>
                <tag>semantic-web</tag>
                <tag>linked-data</tag>
                <tag>rdf</tag>
            </tags>
        </metadata>
        <content>
            <chapter id="1">
                <title>Introduction</title>
                <text>The Semantic Web is an extension of the World Wide Web...</text>
            </chapter>
        </content>
    </book>
</library>
                            </textarea>
                        </div>
                    </div>
                    <div class="output-area">
                        <div class="area-header">Round-trip Result</div>
                        <div class="area-content">
                            <pre id="test5-output"></pre>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="runTest5()">XML → JSON → XML</button>
                    <button onclick="runTest5Compare()">Compare Original vs Result</button>
                </div>
                <div id="test5-status"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { XJX, toNumber, toBoolean, regex } from '../dist/esm/index.js';

        // Make XJX and transforms available globally for testing
        window.XJX = XJX;
        window.toNumber = toNumber;
        window.toBoolean = toBoolean;
        window.regex = regex;

        // Status management
        function showStatus(testId, message, type = 'info') {
            const statusEl = document.getElementById(`${testId}-status`);
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearStatus(testId) {
            const statusEl = document.getElementById(`${testId}-status`);
            statusEl.innerHTML = '';
        }

        // Test 1: Basic XML to JSON
        window.runTest1 = function(mode) {
            try {
                clearStatus('test1');
                const xml = document.getElementById('test1-xml').value.trim();
                const preserveNS = document.getElementById('test1-preserveNS').checked;
                const pretty = document.getElementById('test1-pretty').checked;

                const config = {
                    highFidelity: mode === 'hifi',
                    xml: {
                        preserveNamespaces: preserveNS
                    },
                    json: {
                        prettyPrint: pretty
                    }
                };

                const result = new XJX(config)
                    .fromXml(xml)
                    .toJsonString();

                document.getElementById('test1-output').textContent = result;
                showStatus('test1', `✅ Successfully converted XML to JSON (${mode} mode)`, 'success');
            } catch (error) {
                document.getElementById('test1-output').textContent = `Error: ${error.message}`;
                showStatus('test1', `❌ Conversion failed: ${error.message}`, 'error');
            }
        };

        // Test 2: Complex XML Features
        window.runTest2 = function(mode) {
            try {
                clearStatus('test2');
                const xml = document.getElementById('test2-xml').value.trim();
                const preserveComments = document.getElementById('test2-preserveComments').checked;
                const preserveCDATA = document.getElementById('test2-preserveCDATA').checked;
                const preserveInstructions = document.getElementById('test2-preserveInstructions').checked;

                const config = {
                    highFidelity: mode === 'hifi',
                    preserveComments,
                    preserveInstructions,
                    xml: {
                        preserveCDATA,
                        preserveNamespaces: true,
                        preserveMixedContent: true
                    }
                };

                const result = new XJX(config)
                    .fromXml(xml)
                    .toJsonString();

                document.getElementById('test2-output').textContent = result;
                showStatus('test2', `✅ Successfully processed complex XML features (${mode} mode)`, 'success');
            } catch (error) {
                document.getElementById('test2-output').textContent = `Error: ${error.message}`;
                showStatus('test2', `❌ Processing failed: ${error.message}`, 'error');
            }
        };

        // Test 3: Transforms
        window.runTest3 = function() {
            try {
                clearStatus('test3');
                const xml = document.getElementById('test3-xml').value.trim();
                const transformNumbers = document.getElementById('test3-transformNumbers').checked;
                const transformBooleans = document.getElementById('test3-transformBooleans').checked;
                const transformAttributes = document.getElementById('test3-transformAttributes').checked;

                let xjx = new XJX().fromXml(xml);

                if (transformNumbers) {
                    // Clean currency symbols and convert to numbers
                    xjx = xjx.map(regex(/[$€£,]/g, ''))
                             .map(toNumber({ transformAttr: transformAttributes }));
                }

                if (transformBooleans) {
                    // Convert boolean-like values
                    xjx = xjx.map(toBoolean({ 
                        transformAttr: transformAttributes,
                        trueValues: ['true', 'yes', '1'],
                        falseValues: ['false', 'no', '0']
                    }));
                }

                const result = xjx.toJsonString();
                document.getElementById('test3-output').textContent = result;
                showStatus('test3', '✅ Successfully applied transforms', 'success');
            } catch (error) {
                document.getElementById('test3-output').textContent = `Error: ${error.message}`;
                showStatus('test3', `❌ Transform failed: ${error.message}`, 'error');
            }
        };

        window.runTest3Filter = function() {
            try {
                clearStatus('test3');
                const xml = document.getElementById('test3-xml').value.trim();

                const result = new XJX()
                    .fromXml(xml)
                    .map(toNumber())
                    .filter(node => {
                        // Filter products with rating > 4.0
                        if (node.name === 'rating' && typeof node.value === 'number') {
                            return node.value > 4.0;
                        }
                        return true;
                    })
                    .toJsonString();

                document.getElementById('test3-output').textContent = result;
                showStatus('test3', '✅ Successfully filtered high-rating products', 'success');
            } catch (error) {
                document.getElementById('test3-output').textContent = `Error: ${error.message}`;
                showStatus('test3', `❌ Filter failed: ${error.message}`, 'error');
            }
        };

        // Test 4: JSON Array Handling
        window.runTest4 = function() {
            try {
                clearStatus('test4');
                const json = JSON.parse(document.getElementById('test4-json').value.trim());
                const hifi = document.getElementById('test4-hifi').checked;
                const prettyXml = document.getElementById('test4-prettyXml').checked;

                const config = {
                    highFidelity: hifi,
                    xml: {
                        prettyPrint: prettyXml,
                        declaration: true
                    }
                };

                const result = new XJX(config)
                    .fromJson(json)
                    .toXmlString();

                document.getElementById('test4-output').textContent = result;
                showStatus('test4', '✅ Successfully converted JSON to XML', 'success');
            } catch (error) {
                document.getElementById('test4-output').textContent = `Error: ${error.message}`;
                showStatus('test4', `❌ Conversion failed: ${error.message}`, 'error');
            }
        };

        window.runTest4RoundTrip = function() {
            try {
                clearStatus('test4');
                const json = JSON.parse(document.getElementById('test4-json').value.trim());
                const hifi = document.getElementById('test4-hifi').checked;

                const config = { highFidelity: hifi };

                // JSON → XML → JSON
                const xml = new XJX(config).fromJson(json).toXmlString();
                const backToJson = new XJX(config).fromXml(xml).toJsonString();

                const output = `=== XML (intermediate) ===\n${xml}\n\n=== JSON (final) ===\n${backToJson}`;
                document.getElementById('test4-output').textContent = output;
                showStatus('test4', '✅ Round-trip conversion completed', 'success');
            } catch (error) {
                document.getElementById('test4-output').textContent = `Error: ${error.message}`;
                showStatus('test4', `❌ Round-trip failed: ${error.message}`, 'error');
            }
        };

        // Test 5: Round-trip Integrity
        window.runTest5 = function() {
            try {
                clearStatus('test5');
                const xml = document.getElementById('test5-xml').value.trim();

                const config = {
                    highFidelity: true,
                    preserveComments: true,
                    xml: {
                        preserveNamespaces: true,
                        preserveCDATA: true,
                        declaration: true,
                        prettyPrint: true
                    }
                };

                // XML → JSON → XML
                const json = new XJX(config).fromXml(xml).toJsonString();
                const finalXml = new XJX(config).fromJson(JSON.parse(json)).toXmlString();

                document.getElementById('test5-output').textContent = finalXml;
                showStatus('test5', '✅ Round-trip XML → JSON → XML completed', 'success');
            } catch (error) {
                document.getElementById('test5-output').textContent = `Error: ${error.message}`;
                showStatus('test5', `❌ Round-trip failed: ${error.message}`, 'error');
            }
        };

        window.runTest5Compare = function() {
            try {
                clearStatus('test5');
                const originalXml = document.getElementById('test5-xml').value.trim();
                const resultXml = document.getElementById('test5-output').textContent;

                // Simple comparison (normalize whitespace)
                const normalize = (str) => str.replace(/\s+/g, ' ').trim();
                const original = normalize(originalXml);
                const result = normalize(resultXml);

                if (original === result) {
                    showStatus('test5', '✅ Perfect match! Round-trip preserved all data', 'success');
                } else {
                    showStatus('test5', '⚠️ Some differences detected (expected with format conversion)', 'info');
                }
            } catch (error) {
                showStatus('test5', `❌ Comparison failed: ${error.message}`, 'error');
            }
        };

        // Initialize with first test
        showStatus('test1', 'Ready to test XML to JSON conversion', 'info');
        showStatus('test2', 'Ready to test complex XML features', 'info');
        showStatus('test3', 'Ready to test transforms and functional API', 'info');
        showStatus('test4', 'Ready to test JSON array handling', 'info');
        showStatus('test5', 'Ready to test round-trip integrity', 'info');

        console.log('XJX Semantic Migration Test Suite loaded successfully!');
        console.log('Available functions:', Object.keys(window).filter(k => k.startsWith('run')));
    </script>
</body>
</html>